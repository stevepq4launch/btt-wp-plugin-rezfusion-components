"use strict";(self.webpackChunkrezfusion_components=self.webpackChunkrezfusion_components||[]).push([[873,644],{3452:(e,t,n)=>{var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const a=r(n(7294)).default.createContext();t.default=a},873:(e,t,n)=>{var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(4942)),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var u=a?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(n(7294)),u=r(n(5697)),i=r(n(381)),l=r(n(3452)),s=r(n(9644)),d=n(7124);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){(0,a.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const h="\nquery($item_id: String!, $type: Int!, $channels: ChannelFilter!, $params: OrderQuoteFilter!) {\n  orderQuote(item_id:$item_id, type:$type, channels:$channels, params: $params) {\n    total,\n    subtotal,\n    tax,\n    currency,\n    provider,\n    source,\n    charges {\n      name,\n      base,\n      option,\n      accepted,\n      declined,\n    }\n  }\n}\n",b=e=>{const{children:t,type:n,itemId:r,initialDates:a,initialGuests:u,initialPromoCode:c}=e,[f,b]=(0,o.useState)(!1),[m,y]=(0,o.useState)(),[O,g]=(0,o.useState)(a),[v,P]=(0,o.useState)(u),[j,w]=(0,o.useState)(c),[D,S]=(0,o.useState)(),[_,q]=(0,o.useState)(null),{settings:{components:{SearchProvider:{endpoint:C,channels:k}}}}=(0,o.useContext)(s.default);(0,o.useEffect)((()=>{const e=new URLSearchParams(window.location.search);let t,n,r,a;if(e.has("availFilter")){const o=JSON.parse(e.get("availFilter"));"object"==typeof o&&(t=o.begin?(0,i.default)(o.begin):null,n=o.end?(0,i.default)(o.end):null,r=parseInt(o.adult,10)||1,a=parseInt(o.child,10)||0)}g({begin:t,end:n}),P({adult:r,child:a})}),[]);const M=(0,d.formatDate)(O.begin),Q=(0,d.formatDate)(O.end),{adult:$,child:I}=v;(0,o.useEffect)((()=>{if(y(null),n&&M&&Q){b(!0);const e={item_id:r,type:n,channels:{url:k},params:{begin:M,end:Q,IDs:{[n]:[r]},adult:$,child:I,coupon:j}};(0,d.fetchData)(h,e,C).then((e=>e.json())).then((t=>{t&&t.data&&t.data.orderQuote?(j?(0,d.fetchData)(h,p(p({},e),{},{params:p(p({},e.params),{},{coupon:void 0})}),C).then((e=>e.json())).then((e=>{if(e&&e.data&&e.data.orderQuote){const n=t.data.orderQuote.total,r=e.data.orderQuote.total;q(n<r)}})).catch((e=>{console.error(e)})):q(null),y(t.data.orderQuote),S(null)):(S("An error occurred while fetching quotes."),console.error("Order quote not found."))})).catch((e=>{console.error(e),S("An error occurred while fetching quotes")})).finally((()=>{b(!1)}))}}),[M,Q,$,I,j,n,r,k,C]);const E={itemId:r,type:n,dates:O,setDates:g,guests:v,setGuests:P,promoCode:j,setPromoCode:w,quoteError:D,quoteLoading:f,orderQuote:m,promoStatus:_};return o.default.createElement(l.default.Provider,{value:E},t)};t.default=b,b.propTypes={children:u.default.node.isRequired,itemId:u.default.string.isRequired,type:u.default.number.isRequired,initialDates:u.default.shape({begin:u.default.instanceOf(i.default.Moment),end:u.default.instanceOf(i.default.Moment)}),initialGuests:u.default.exact({adult:u.default.number.isRequired,child:u.default.number.isRequired}),initialPromoCode:u.default.string},b.defaultProps={initialDates:{begin:null,end:null},initialGuests:{adult:1,child:0},initialPromoCode:null}},9644:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});const r=n(7294).createContext(null)}}]);