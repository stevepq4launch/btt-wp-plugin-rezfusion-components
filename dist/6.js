"use strict";(self.webpackChunkrezfusion_components=self.webpackChunkrezfusion_components||[]).push([[6],{9121:(e,t,s)=>{var i=s(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.Select=t.Checkbox=void 0;var r=i(s(9163));const a=r.default.input.attrs({type:"checkbox"}).withConfig({displayName:"src__Checkbox",componentId:"sc-kwnso-0"})(['border:1px solid #ccc;-webkit-appearance:none;width:2rem;height:2rem;margin-right:0.5rem;&:checked{background:url(\'data:image/svg+xml;utf8,<svg data-name="cross" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="%23fff" id="Combined-Shape" d="M19.6,31.4l-6-6c-0.7-0.8-0.6-2.1,0.2-2.8c0.7-0.6,1.9-0.6,2.6,0l4.6,4.6l9.6-9.6c0.7-0.8,2-0.9,2.8-0.2s0.9,2,0.2,2.8c-0.1,0.1-0.1,0.2-0.2,0.2l-11,11C21.6,32.2,20.4,32.2,19.6,31.4z"/></svg>\');background-color:',";}"],(e=>e.theme.buttonAccentColor||"#666"));t.Checkbox=a;const n=r.default.select.withConfig({displayName:"src__Select",componentId:"sc-kwnso-1"})(['appearance:none;background-color:#fff;background-image:url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100;" xml:space="preserve"><g><polygon points="82.2,44.9 73.6,36.5 51.2,59.4 28.3,37 19.9,45.6 51.4,76.4  "/></g></svg>\');background-position:right .7em top 60%,0 0;background-repeat:no-repeat,repeat;background-size:.95em auto,100%;border:',";border-radius:0;box-sizing:border-box;color:#444;display:block;font-size:14px;height:",";line-height:1.3;margin:0;max-width:100%;padding:.6em 1.9em .5em .8em;width:100%;&::-ms-expand{display:none;}&:hover{border-color:#888;}&:focus{border-color:#999;box-shadow:0 0 1px 3px rgba(59,153,252,.7);box-shadow:0 0 0 3px -moz-mac-focusring;color:#222;outline:none;}option{font-weight:normal;}"],(e=>e.theme.border),(e=>e.theme.buttonHeight));t.Select=n},3796:(e,t,s)=>{s.r(t),s.d(t,{default:()=>h});var i=s(7294),r=s(5697),a=s.n(r),n=s(3153),l=s(9644),o=s(4175),c=s(7124);const d={...(0,o.getConfiguration)()},h=({children:e,userProvided:t})=>i.createElement(l.default.Provider,{value:(0,c.deepMerge)(d,t)},e);h.propTypes={userProvided:a().shape(n.configurationShape)},h.defaultProps={userProvided:{}}},7422:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});const i=s(7294).createContext(void 0)},5100:(e,t,s)=>{s.r(t),s.d(t,{createParamsFromContext:()=>u,updateURL:()=>f,SearchProvider:()=>m});var i=s(7294),r=s(5697),a=s.n(r),n=s(381),l=s.n(n),o=s(7699),c=s(7124),d=s(28),h=s(2791),g=s(7422);const u=e=>{const{filters:t,sort:s,favoritesMode:i}=e,r=Object.entries(t).reduce(((e,[t,s])=>(s?e.set(t,JSON.stringify(s)):e.delete(t),e)),new URLSearchParams(window.location.search||""));return s&&r.set("sort",s),i&&!r.has("favoritesMode")&&r.set("favoritesMode","1"),!i&&r.has("favoritesMode")&&r.delete("favoritesMode"),r},f=e=>{const t=u(e);if(window.location.search.replace("?","")!==`${t}`){const e=""==`${t}`?window.location.pathname:`${window.location.pathname}?${t}`;history.replaceState({},"",e)}};class m extends i.Component{constructor(e){super(e),this.getDefaultFilters=()=>{const{channels:e,nonBookableThreshold:t,filters:s}=this.props,{filters:{itemIds:i}}=this.state;return{channels:{url:e},bedsFilter:{},bathsFilter:{},occFilter:{},ratingFilter:{},availFilter:{begin:null,end:null,adult:1,child:0,non_bookable:null,non_bookable_threshold:t},categoryFilter:{categories:[]},nameFilter:{text:""},...s,itemIds:i}},this.setTextFilter=(e="",t=!1)=>{const{state:s}=this,i={filters:{...s.filters,nameFilter:{text:`${e}`}}};this.setState(i,(()=>{const{filters:e}=this.state;t&&(this.search(e),f(this.state))}))},this.setRangeFilter=({min:e,max:t},s,i=!0)=>{const{state:r}=this,a={filters:{...r.filters,[s]:{min:e,max:t}}};this.setState(a,(()=>{if(i){const{filters:e}=this.state;this.search(e),f(this.state)}}))},this.setCategoryFilter=(e,t=!0)=>{const{state:s}=this;if(!s.filters.categoryFilter.categories.length){const i={filters:{...s.filters,categoryFilter:{categories:[e]}}};return void this.setState(i,(()=>{if(t){const{filters:e}=this.state;this.search(e),f(this.state)}}))}const i=s.filters.categoryFilter.categories,r=i.findIndex((t=>t.cat_id===e.cat_id));-1!==r?i.splice(r,1,e):i.push(e);const a={filters:{...s.filters,categoryFilter:{categories:i.filter((e=>e.values.length))}}};this.setState(a,(()=>{if(t){const{filters:e}=this.state;this.search(e),f(this.state)}}))},this.setAvailDates=(e,t,s=!0)=>{const{filters:i}=this.state,r={filters:{...i,availFilter:{...i.availFilter,begin:(0,c.formatDate)(e),end:(0,c.formatDate)(t)}}};this.setState(r,(()=>{const{filters:{availFilter:{begin:e,end:t}}}=r;if(s)if(e||t){if(e&&l()(e,o.DATE_FORMAT,!0).isValid()&&t&&l()(t,o.DATE_FORMAT,!0).isValid()){f(this.state);const e=()=>{this.setSort(d.ER.PriceDsc)};this.search(r.filters,e)}}else{const{sort:e}=this.props;this.setSort(e),f(this.state),this.search(r.filters)}}))},this.setBookable=e=>{const{filters:t}=this.state,s={filters:{...t,availFilter:{...t.availFilter,non_bookable:e}}};this.setState(s,(()=>{const{filters:e}=this.state;this.search(e),f(this.state)}))},this.setAvailParam=(e,t)=>{const{filters:s}=this.state,i={filters:{...s,availFilter:{...s.availFilter,[e]:t}}};this.setState(i,(()=>{f(this.state)}))},this.setAvailParams=e=>{const{filters:t}=this.state,s={filters:{...t,availFilter:{...t.availFilter}}};Object.entries(e).forEach((([e,t])=>{s.filters.availFilter[e]=t})),this.setState(s)},this.setSort=e=>{const{results:t}=this.state,s=this.getSort(e);if(s){const i={results:s.callback(t,s),sort:e};this.setState(i,(()=>{f(this.state)}))}else console.error("Invalid new sort key.")},this.getSort=e=>{const{sorts:t}=this.props;return t.find((t=>t.key===e))},this.getCategoryInfo=async()=>{const{endpoint:e}=this.props,{filters:{channels:t}}=this.state;return await this.setState({loadingCategories:!0}),(0,c.fetchData)("\n        query($channels: ChannelFilter!) {\n            categoryInfo(channels: $channels) {\n                categories {\n                    name,\n                    id,\n                    description,\n                    options {\n                        show_search,\n                        show_quick_search,\n                        show_details,\n                        query_operator,\n                    },\n                    values {\n                        description,\n                        id,\n                        name,\n                        options {\n                            show_search,\n                            show_details,\n                        }\n                    }\n                }\n            }\n        }",{channels:t},e).then((e=>e.json())).then((e=>this.setCategoryInfo(e)))},this.setExactFilter=(e,t)=>{const{exactFilters:s}=this.state,i={exactFilters:{...s}};i.exactFilters[e]=t,this.setState(i)},this.setFlexibleStayRange=e=>{const{filters:t}=this.state,s={filters:{...t,availFilter:{...t.availFilter,flex_amt:e}}};this.setState(s,(()=>{f(this.state)}))},this.setFlexibleStayType=e=>{const{filters:t}=this.state,s={filters:{...t,availFilter:{...t.availFilter,flex_type:e}}};this.setState(s,(()=>{f(this.state)}))},this.setFlexibleStay=(e,t)=>{const{filters:s}=this.state,{availFilter:i}=s,r={filters:{...s,availFilter:{...i,flex_type:e,flex_amt:t}}};this.setState(r,(()=>{f(this.state)}))},this.getFlexibleStayRange=()=>{const{filters:{availFilter:{flex_amt:e}}}=this.state;return e},this.getFlexibleStayType=()=>{const{filters:{availFilter:{flex_type:e}}}=this.state;return e},this.search=(e,t)=>{const{flaggedItems:s}=this.props,{favoritesMode:i}=this.state;i&&Array.isArray(s)&&!s.length?this.setState({hasPerformedInitialSearch:!0,results:[]}):this.setState({searching:!0},(()=>{const{endpoint:s}=this.props,{query:i}=this.state;(0,c.fetchData)(i,e,s).then((e=>e.json())).then((e=>this.setResults(e))).then((()=>this.setState({searching:!1,hasPerformedInitialSearch:!0}))).then((()=>{"function"==typeof t&&t()}))}))},this.clearSearchFilters=()=>{const{sort:e}=this.props,t=this.getDefaultFilters();this.setState({filters:{...t},exactFilters:{}},(()=>{this.setSort(e),f(this.state),this.search(t)}))},this.toggleFavoritesMode=()=>{const{filters:{itemIds:e}}=this.props,{favoritesMode:t,filters:s}=this.state,i=!t;let r;if(i){const{flaggedItems:e}=this.props;r={...s,itemIds:e}}else r={...s,itemIds:Array.isArray(e)?e:null};this.setState({favoritesMode:i,filters:r},(()=>{const{filters:e}=this.state;this.search(e),f(this.state)}))},this.removeResult=e=>{const{results:t,filters:s}=this.state,{itemIds:i}=s;i&&this.setState({results:t.filter((t=>t.item.id!==e)),filters:{...s,itemIds:i.filter((t=>t!==e))}})};const{channels:t,sort:s,teaserFragment:i,query:r,enableReviews:a,flaggedItems:n,filters:h,nonBookableThreshold:g}=e;let u;u=r||(e=>`\n    query(\n    $channels: ChannelFilter!,\n    $bedsFilter: Range,\n    $bathsFilter: Range,\n    $occFilter: Range,\n    $ratingFilter: Range,\n    $categoryFilter: CategoryFilterList,\n    $availFilter: AvailabilityFilter,\n    $nameFilter: Text,\n    $itemIds: [String]) {\n        lodgingProducts(\n            channels: $channels,\n            beds: $bedsFilter,\n            baths: $bathsFilter,\n            occ_total: $occFilter,\n            rating: $ratingFilter,\n            category_filter: $categoryFilter,\n            itemIds: $itemIds,\n            availability: $availFilter,\n            name: $nameFilter) {\n            results {\n                ${e}\n            }\n        }\n    }\n`)(i||`\nid,\nbeds,\nbaths,\nhalf_baths,\nocc_total,\nitem {\n    ${a?"\nreviewSummary {\n  average,\n  count\n}\n":""}\n    images(limit: 1) {\n        url,\n        description,\n        title,\n        derivatives\n    }\n    location {\n        latitude,\n        longitude\n    }\n    id,\n    type,\n    name,\n    remote_id,\n        quoteList {\n        quotes {\n            price,\n            price_breakdown {\n              pricePerWeek,\n              pricePerNight,\n              pricePerTraveler,\n              pricePersonPerNight,\n            },\n            params,\n            savings,\n            currency,\n            name,\n            id,\n            provider,\n            source,\n            type,\n            bookable,\n            display_detail {\n                type,\n                message,\n            }\n        }\n    }\n}\n`);const m={channels:{url:t},bedsFilter:{},bathsFilter:{},occFilter:{},ratingFilter:{},availFilter:{begin:null,end:null,adult:1,child:0,non_bookable:null,non_bookable_threshold:g},categoryFilter:{categories:[]},nameFilter:{text:""},...h},b=new URLSearchParams(window.location.search||""),p=Object.keys(m).reduce(((e,t)=>{const s=b.get(t);if("string"!=typeof s)return e;let i;try{i=JSON.parse(s)}catch(e){console.error(`Malformed query parameters. Unable to parse values for ${t}. Using default values instead`),console.error(e),i=m[t]}return s?{...e,[t]:i}:e}),{}),y=b.get("sort");let{itemIds:v}=h;const F=b.has("favoritesMode");F&&(v=n);const{availFilter:x,...S}=p,{availFilter:k,...w}=m;this.state={filters:{...w,...S,availFilter:{...k,...x},itemIds:v},exactFilters:{},results:[],categoryInfo:{},searching:!1,hasPerformedInitialSearch:!1,sort:(0,d.Lu)(y)?y:s,query:u,hasError:!1,favoritesMode:F,loadingCategories:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidMount(){const{mountCallback:e}=this.props;e&&"function"==typeof e&&e(this)}setResults(e){const{sort:t}=this.state,{results:s}=e.data.lodgingProducts;if(e.errors)return e.errors.forEach((e=>{console.error(e.message)})),void this.setState({results:[],hasError:!0});let i;const r=this.getSort(t);if(r)i=r;else{const{sort:e}=this.props;i=this.getSort(e)}const a={results:i.callback(s,i)||[]};this.setState(a)}setCategoryInfo(e){const t={categoryInfo:e.data.categoryInfo.categories||[],loadingCategories:!1};this.setState(t)}render(){const{channels:e,children:t,contactNumber:s,enableReviews:r,endpoint:a,itemDetailsPath:n,itemDetailsQuery:l,sorts:o,zeroResultMessage:c}=this.props,{filters:d,categoryInfo:h,results:u,searching:f,loadingCategories:m,sort:b,hasPerformedInitialSearch:p,exactFilters:y,hasError:v,favoritesMode:F}=this.state;return v?i.createElement("h1",null,"An error occurred."):i.createElement(g.default.Provider,{value:{setTextFilter:this.setTextFilter,setRangeFilter:this.setRangeFilter,setCategoryFilter:this.setCategoryFilter,setAvailDates:this.setAvailDates,setAvailParam:this.setAvailParam,setAvailParams:this.setAvailParams,setBookable:this.setBookable,search:this.search,setSort:this.setSort,getDefaultFilters:this.getDefaultFilters,clearSearchFilters:this.clearSearchFilters,setExactFilter:this.setExactFilter,toggleFavoritesMode:this.toggleFavoritesMode,removeResult:this.removeResult,setFlexibleStay:this.setFlexibleStay,setFlexibleStayType:this.setFlexibleStayType,setFlexibleStayRange:this.setFlexibleStayRange,getFlexibleStayType:this.getFlexibleStayType,getFlexibleStayRange:this.getFlexibleStayRange,sort:b,sorts:o,filters:d,exactFilters:y,categoryInfo:h,contactNumber:s,enableReviews:!!r,results:u,searching:f,loadingCategories:m,itemDetailsPath:n,itemDetailsQuery:l,hasPerformedInitialSearch:p,endpoint:a,channels:e,zeroResultMessage:c,favoritesMode:F}},t)}}m.propTypes={channels:a().string,children:a().oneOfType([a().node,a().arrayOf(a().node)]).isRequired,contactNumber:a().string,enableReviews:a().bool,endpoint:a().string.isRequired,filters:a().exact({availFilter:a().exact({adult:a().number,child:a().number,begin:a().string,end:a().string,non_bookable:a().bool,non_bookable_threshold:a().number}),bathsFilter:a().exact({min:a().number,max:a().number}),bedsFilter:a().exact({min:a().number,max:a().number}),categoryFilter:a().objectOf(a().any),channels:a().exact({url:a().string}),itemIds:a().arrayOf(a().string),nameFilter:a().exact({text:a().string}),occFilter:a().exact({min:a().number,max:a().number})}),itemDetailsPath:a().string,itemDetailsQuery:a().objectOf(a().oneOfType([a().string,a().bool,a().number])),mountCallback:a().func,nonBookableThreshold:a().number,query:a().string,sort:a().string,sorts:a().arrayOf(a().exact({key:a().string.isRequired,label:a().string.isRequired,field:a().string.isRequired,direction:a().oneOf(["asc","desc"]),callback:a().func.isRequired,disabled:a().func})),teaserFragment:a().string,zeroResultMessage:a().string,flaggedItems:a().arrayOf(a().string)},m.defaultProps={channels:"",contactNumber:null,enableReviews:!1,filters:{},itemDetailsPath:null,itemDetailsQuery:null,mountCallback:null,nonBookableThreshold:-1,query:null,sort:"random",sorts:h.sortOptions,teaserFragment:null,zeroResultMessage:"Try removing some filters, or clear your search below.",flaggedItems:null}},2791:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x,sortAlpha:()=>f,sortNumeric:()=>b,sortRandom:()=>y,sortPrice:()=>p,sortOptions:()=>S});var i=s(7294),r=s(5697),a=s.n(r),n=s(9163),l=s(7422),o=s(7124),c=s(4175),d=s(9121),h=s(28);const g=e=>{switch(typeof e){case"string":return e;case"number":return e.toString(10);default:return null}},u=new Intl.Collator("en",{numeric:!0}),f=(e,{field:t,direction:s})=>{const i=t.split(".");return e.sort(((e,t)=>u.compare(g((0,o.at)(...i)(e)),g((0,o.at)(...i)(t))))),"desc"===s&&e.reverse(),e},m=e=>"number"==typeof e?e:"string"==typeof e?parseFloat(e):0,b=(e,{field:t,direction:s})=>{const i=t.split(".");return e.sort(((e,t)=>{const s=(0,o.at)(...i)(e),r=(0,o.at)(...i)(t);return m(s)-m(r)})),"desc"===s&&e.reverse(),e},p=(e,{field:t,direction:s})=>{const i=t.split(".");return e.length?(e.sort(((e,t)=>{const s=(0,o.at)(...i)(e),r=(0,o.at)(...i)(t);return s[0].price-r[0].price})),"desc"===s&&e.reverse(),e):e},y=e=>(0,o.arrayShuffle)(e),v=e=>t=>{const{setSort:s}=e,i=(e=>e.target[e.target.selectedIndex].getAttribute("data-key"))(t);(0,h.Lu)(i)?s(i):console.error("Bad sort type")},F=(0,n.default)(d.Select)`
  border: none;
`,x=({className:e})=>i.createElement(l.default.Consumer,null,(t=>{const{sort:s,sorts:r}=t;return i.createElement("div",{className:"sort"},i.createElement(F,{value:s,onChange:v(t),className:e},((e,t)=>e.filter((e=>{const{disabled:s}=e;return void 0===s||s(t)})))(r,t).map((({label:e,key:t})=>i.createElement("option",{key:t,value:t,"data-key":t},e)))))}));x.propTypes={className:a().string},x.defaultProps={className:void 0};const S=[{key:h.ER.Random,field:"id",direction:h.As.Ascending,label:"Sort",callback:y},{key:h.ER.PriceAsc,field:"item.quoteList.quotes",direction:h.As.Ascending,label:"Price: Low to High",disabled:e=>{const{availFilter:t}=e.filters;return!!t.begin&&!!t.end||!1},callback:p},{key:h.ER.PriceDsc,field:"item.quoteList.quotes",direction:h.As.Descending,label:"Price: High to Low",disabled:e=>{const{availFilter:t}=e.filters;return!!t.begin&&!!t.end||!1},callback:p},{key:h.ER.NameAsc,field:"item.name",direction:h.As.Ascending,label:"Name: A-Z",callback:f},{key:h.ER.NameDsc,field:"item.name",direction:h.As.Descending,label:"Name: Z-A",callback:f},{key:h.ER.BedsAsc,field:"beds",direction:h.As.Ascending,label:"Beds: Low to High",callback:b},{key:h.ER.BedsDsc,field:"beds",direction:h.As.Descending,label:"Beds: High to Low",callback:b},{key:h.ER.BathsAsc,field:"baths",direction:h.As.Ascending,label:"Baths: Low to High",callback:b},{key:h.ER.BathsDsc,field:"baths",direction:h.As.Descending,label:"Baths: High to Low",callback:b},{key:h.ER.OccupancyAsc,field:"occ_total",direction:h.As.Ascending,label:"Occupancy: Low to High",callback:b},{key:h.ER.OccupancyDsc,field:"occ_total",direction:h.As.Descending,label:"Occupancy: High to Low",callback:b},{key:h.ER.Rating,field:"item.reviewSummary.average",direction:h.As.Descending,label:"Review Rating",callback:b,disabled:e=>e.enableReviews},{key:h.ER.ReviewCount,field:"item.reviewSummary.count",direction:h.As.Descending,label:"Number of Reviews",callback:b,disabled:e=>e.enableReviews},...(0,c.getConfiguration)().settings.components.SearchProvider.sortOptions]},28:(e,t,s)=>{function i(e){return"w"===e||"d"===e}var r,a;s.d(t,{WU:()=>i,As:()=>r,ER:()=>a,Lu:()=>n}),function(e){e.Ascending="asc",e.Descending="desc"}(r||(r={})),function(e){e.Random="random",e.PriceAsc="item_quote_price_asc",e.PriceDsc="item_quote_price_desc",e.NameAsc="item_name_asc",e.NameDsc="item_name_desc",e.BedsAsc="beds_asc",e.BedsDsc="beds_desc",e.BathsAsc="baths_asc",e.BathsDsc="baths_desc",e.OccupancyAsc="occ_total_asc",e.OccupancyDsc="occ_total_desc",e.Rating="review_average_rating",e.ReviewCount="review_count"}(a||(a={}));const n=e=>Object.values(a).includes(e);var l;!function(e){e[e.Sunday=1]="Sunday",e[e.Monday=2]="Monday",e[e.Tuesday=3]="Tuesday",e[e.Wednesday=4]="Wednesday",e[e.Thursday=5]="Thursday",e[e.Friday=6]="Friday",e[e.Saturday=7]="Saturday"}(l||(l={}))}}]);